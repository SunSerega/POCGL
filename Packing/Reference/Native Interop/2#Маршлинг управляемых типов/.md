


Большинство проблем при использовании неуправляемых .dll вытекают из следующих 2 различий:

1. В .Net строки и массивы это стандартные типы, доступные для всех .Net языков.
	
	А в C++ строки и массивы не только описаны не так же как в .Net .
	У них так же есть множество разных стандартов.
	Благо, исходные библиотеки придерживаются одного общего стандарта.

2. В управляемом коде оперативная память (дальше просто память) обычно управляется сборщиком мусора.
	Поэтому если создать массив - когда он стал не нужен о нём можно просто забыть.
	
	А в C++ память управляется только программистом, поэтому неуправляемую память нужно всегда освобождать после использования.\
	Забытая и не_освобождённая неуправляемая память называется утечкой памяти. И это один из самых сложно-ловимых багов,
	потому что у него нет явно видимых симптомов, вроде вызова ошибки, пока память окончательно не закончится.

В .Net так же можно выделять и освобождать неуправляемую память, статическими методами класса `Marshal`:
`.AllocHGlobal` и `.FreeHGlobal` соответственно. Обычно это надо для п.1., для преобразований между
управляемыми и неуправляемыми типами.

Ещё одно отличие неуправляемой памяти - она не очищается нулями при выделении, а
значит содержит мусорные данные. И память GPU (к примеру, содержимое буферов) тоже.

Полное имя класса `Marshal` это `System.Runtime.InteropServices.Marshal`.
Чтобы не писать его целиком - можно написать в начале файла `uses System.Runtime.InteropServices`, и дальше писать только `Marshal`.

---

Стоит так же заметить, что в н.у. модулях все подпрограммы, напрямую вызывающие подпрограммы из неуправляемых
.dll принимают параметрами как неуправляемые, так и управляемые типы массивов и строк, по мере необходимости.

Если ваша необходимость не удовлетворена (то есть не хватает перегрузки с определённым типом) - это особо хороший повод написать в issue.

---

# Страницы:

- <a path="Тесты эффектов сборщика мусора"	>	Тесты эффектов сборщика мусора	</a>
- <a path="var-параметры"					>	`var`-параметры					</a>
- <a path="Массивы"							>	Массивы							</a>
- <a path="Строки"							>	Строки							</a>
- <a path="Делегаты"						>	Делегаты						</a>


